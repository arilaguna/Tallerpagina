<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LAGGER — Especialistas en Clutch y Frenos</title>
  <meta name="description" content="App de una sola página para LAGGER: diagnóstico con IA, agendar citas y presentación del taller. Diseño llamativo con microinteracciones (HTML+CSS+JS)." />
  <style>
    :root{
      --bg:#0b0e13;
      --panel:#121723;
      --panel-2:#171d2a;
      --text:#f1f4fa;
      --muted:#9aa3b2;
      --primary:#ff3b30;
      --accent:#5fd3f3;
      --shadow: rgba(0,0,0,.35);
      --radius: 16px; --gap: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial;
      color:var(--text);
      background: radial-gradient(1200px 600px at 80% -20%, #1f2430 0%, rgba(31,36,48,0) 60%),
                  radial-gradient(900px 500px at -10% 20%, #19202d 0%, rgba(26,31,42,0) 60%),
                  linear-gradient(180deg, #0a0d12, var(--bg));
      overflow-x:hidden;
    }
    .glow{position:fixed; inset:auto -20% 40% -20%; height:60vh; pointer-events:none; filter: blur(60px); opacity:.35; z-index:0;
      background: radial-gradient(40% 50% at 20% 30%, #ff3b3040, transparent 70%),
                  radial-gradient(45% 55% at 80% 60%, #5fd3f340, transparent 70%);
      animation: float 10s ease-in-out infinite alternate;
    }
    @keyframes float{to{transform:translateY(-30px)}}

    header{ position:sticky; top:0; z-index:60; backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(13,16,22,.85), rgba(13,16,22,.55)); border-bottom:1px solid rgba(255,255,255,.06); }
    .wrap{max-width:1200px; margin:0 auto; padding:14px 18px; position:relative; z-index:1}

    .brand{display:flex; align-items:center; gap:12px}
    /* FIX: bloque correcto del logo */
    .logo-img{
      <img class="logo-img"
     src="https://arilaguna.github.io/lagger-web/assets/img/logo-lagger.png"
     alt="LAGGER logo" loading="lazy">
      width:46px; height:46px; object-fit:contain;
      border-radius:10px; background:#0f141f;
      border:1px solid rgba(255,255,255,.08);
      padding:6px; box-shadow:0 6px 24px rgba(255,59,48,.15)
    }
    .brand h1{margin:0; font-size:20px; letter-spacing:.3px}

    nav{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .tab{appearance:none; border:1px solid rgba(255,255,255,.08); background:var(--panel); color:var(--text);
      padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700; transition:transform .15s ease, box-shadow .2s ease}
    .tab:hover{transform:translateY(-1px); box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .tab[aria-current="page"]{background:var(--primary); border-color:transparent; box-shadow:0 10px 30px rgba(255,59,48,.35)}

    /* HERO */
    .hero{position:relative; z-index:1; padding:28px 18px 8px}
    .hero-inner{max-width:1200px; margin:0 auto; display:grid; gap:18px; align-items:center}
    @media(min-width:980px){.hero-inner{grid-template-columns:1.2fr .8fr}}
    .hero h2{font-size: clamp(26px, 3.4vw, 42px); margin:0 0 6px}
    .hero p{color:var(--muted); margin:0 0 10px}
    .cta{display:flex; gap:12px; flex-wrap:wrap; margin-top:8px}
    .btn{appearance:none; border:none; background:var(--primary); color:white; padding:12px 16px; font-weight:800; border-radius:14px; cursor:pointer; letter-spacing:.3px;
      transition: transform .15s ease, box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px); box-shadow:0 10px 28px rgba(255,59,48,.35)}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,.14)}
    .hero-ill{aspect-ratio:16/10; border-radius:18px; background:linear-gradient(135deg,#121723,#1a2231); border:1px solid rgba(255,255,255,.06);
      box-shadow:0 18px 50px var(--shadow); position:relative; overflow:hidden}
    .hero-ill:before{content:""; position:absolute; inset:-40% -20% auto -20%; height:130%; background:
      radial-gradient(40% 50% at 20% 40%, #ff3b3026, transparent 70%),
      radial-gradient(45% 55% at 70% 65%, #5fd3f326, transparent 70%);} 
    .hero-ill img{width:100%; height:100%; object-fit:cover; opacity:.9}

    /* Layout principal */
    main{padding: 10px 18px 24px}
    .grid{display:grid; gap:var(--gap)}
    @media(min-width:980px){.grid{grid-template-columns: 1.2fr .8fr}}

    /* Cards */
    .card{position:relative; background:var(--panel); border-radius:var(--radius); box-shadow:0 14px 40px var(--shadow)}
    .card:before{content:""; position:absolute; inset:0; padding:1px; border-radius:inherit; background:linear-gradient(135deg, #283246, rgba(255,255,255,.06), #283246);
      -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events:none}
    .card>*{padding:18px 18px 0}
    .card h2{margin:0 0 8px 0; font-size:18px}
    .card .intro{color:var(--muted); margin:-4px 0 12px; font-size:14px}
    .card .body{padding-bottom:16px}
    .muted{color:var(--muted); font-size:14px}

    .row{display:flex; gap:12px; flex-wrap:wrap}
    .row .field{flex:1 1 220px}
    label{display:block; font-weight:700; font-size:14px; margin-bottom:6px}
    input, select, textarea{width:100%; background:var(--panel-2); border:1px solid rgba(255,255,255,.08); color:var(--text); padding:10px 12px; border-radius:12px; outline:none}
    textarea{min-height:92px; resize:vertical}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .btn.alt{background:var(--accent); color:#071018}

    .hidden{display:none !important}
    .result{background:#0f141d; border-top:1px solid rgba(255,255,255,.06); padding:14px 18px 18px}

    .status{font-size:12px; padding:6px 10px; border-radius:999px; display:inline-block}
    .ok{background:rgba(46, 204, 113,.15); color:#98e6b9}
    .warn{background:rgba(243, 156, 18,.15); color:#f8d6a8}
    .err{background:rgba(231, 76, 60,.15); color:#f7b0a6}

    aside .card ul{list-style:none; padding-left:0}
    aside .card li{margin:6px 0}

    .ribbon{display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin:12px 0 6px}
    .chip{background:linear-gradient(180deg,#121723,#0d121b); border:1px solid rgba(255,255,255,.08); padding:10px 12px; border-radius:999px; text-align:center; font-weight:700; color:#e6ecf7}
    .chip small{display:block; color:var(--muted); font-weight:600}
    @media(max-width:680px){.ribbon{grid-template-columns:1fr}}

    footer{padding:22px 18px; border-top:1px solid rgba(255,255,255,.06); color:var(--muted)}
    small code{opacity:.8}

    /* WhatsApp FAB */
    .wa-fab{
      position:fixed; right:14px; bottom:14px; z-index:80;
      display:inline-flex; align-items:center; gap:10px;
      background:#25D366; color:#041b10; font-weight:900;
      border:none; border-radius:999px; padding:12px 16px; cursor:pointer;
      box-shadow:0 12px 30px rgba(0,0,0,.35);
      text-decoration:none;
    }
    .wa-fab svg{width:22px; height:22px}
    .wa-fab:hover{transform:translateY(-1px)}
    @media(max-width:560px){ .wa-fab span{display:none} }

    .reveal{opacity:0; transform:translateY(10px); transition:opacity .35s ease, transform .35s ease}
    .reveal.show{opacity:1; transform:none}

    .gallery{display:grid; grid-template-columns:repeat(3, 1fr); gap:10px}
    .gallery img{width:100%; height:100%; object-fit:cover; border-radius:12px; aspect-ratio:16/10; background:#0c1119; border:1px solid rgba(255,255,255,.06)}
    @media(max-width:820px){.gallery{grid-template-columns:1fr 1fr}}
  </style>
</head>
<body>
  <div class="glow" aria-hidden="true"></div>

  <header>
    <div class="wrap">
      <div class="brand">
        <img class="logo-img" src="https://drive.usercontent.google.com/download?id=1hi9qfyl9Zz3DvtLxJiEM5c93WWjfazk4&export=view&authuser=0" alt="LAGGER logo">
        <h1>LAGGER · Especialistas en Clutch y Frenos</h1>
      </div>
      <nav aria-label="Secciones">
        <button class="tab" data-route="#/diagnostico">Diagnóstico</button>
        <button class="tab" data-route="#/agendar">Agendar</button>
        <button class="tab" data-route="#/faq">Preguntas Frecuentes</button>
        <button class="tab" data-route="#/nosotros">Sobre nosotros</button>
      </nav>
    </div>
  </header>

  <!-- HERO dinámico -->
  <section class="hero">
    <div class="hero-inner" id="heroInner">
      <!-- Se llena dinámicamente según la ruta -->
      <div>
        <h2>Mantén tu unidad trabajando, sin sorpresas</h2>
        <p>Diagnóstico claro, citas confirmadas y atención experta en <strong>clutch, frenos y aire</strong> para transporte pesado y ligero.</p>
        <div class="cta">
          <button class="btn" id="ctaDx">Diagnóstico rápido</button>
          <button class="btn ghost" id="ctaAg">Agendar cita</button>
        </div>
        <div class="ribbon">
          <div class="chip">&lt; 5 min<small>Tiempo de respuesta</small></div>
          <div class="chip">+20%<small>Citas confirmadas</small></div>
          <div class="chip">Garantía<small>Servicio profesional</small></div>
        </div>
      </div>
      <div class="hero-ill">
        <img id="heroImg" src="https://drive.google.com/uc?export=view&id=1t6xiJtCjua_H-5DRxCKaHHAH006uCJVo" alt="LAGGER — clutch, frenos y aire">
      </div>
    </div>
  </section>

  <main class="wrap grid">
    <section>
      <!-- DIAGNÓSTICO (sin datos del cliente) -->
      <article id="route-diagnostico" class="card reveal" aria-labelledby="tit-dx">
        <h2 id="tit-dx">Diagnóstico con IA: posibles fallas según tu síntoma</h2>
        <p class="intro">Describe el <strong>síntoma</strong> y algunos <strong>detalles</strong>. Te sugeriremos el servicio probable, causa, tiempo y rango de costo. *No sustituye la inspección física.*</p>
        <div class="body">
          <form id="form-dx" autocomplete="on">
            <div class="row">
              <div class="field">
                <label for="symptom">Síntoma principal</label>
                <select id="symptom" name="symptom" required>
                  <option value="">Selecciona…</option>
                  <option>Ruido al frenar</option>
                  <option>Vibración al frenar</option>
                  <option>Pedal esponjoso</option>
                  <option>Pierde presión de aire</option>
                  <option>Patina el clutch</option>
                  <option>Dificultad para meter velocidades</option>
                </select>
              </div>
              <div class="field">
                <label for="unitType">Tipo de unidad</label>
                <select id="unitType" name="unitType" required>
                  <option value="">Selecciona…</option>
                  <option>Tráiler</option>
                  <option>Camión</option>
                  <option>Auto</option>
                </select>
              </div>
              <div class="field">
                <label for="year">Año</label>
                <input id="year" name="year" type="number" min="1980" max="2099" placeholder="2018" required />
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label for="details">Detalles (opcional)</label>
                <textarea id="details" name="details" maxlength="600" placeholder="Ej.: el ruido aparece a baja velocidad, el pedal se hunde, etc."></textarea>
              </div>
            </div>
            <div class="actions">
              <button class="btn" type="submit">Generar diagnóstico</button>
              <button class="btn ghost" type="reset">Limpiar</button>
            </div>
          </form>
          <div id="dx-result" class="result hidden" aria-live="polite"></div>
        </div>
      </article>

      <!-- AGENDAR -->
      <article id="route-agendar" class="card reveal hidden" aria-labelledby="tit-ag">
        <h2 id="tit-ag">Agenda tu cita: elegimos fecha y hora</h2>
        <p class="intro">Elige el <strong>serivcio</strong> y confirma la <strong>fecha y hora</strong>. Si necesitas ayuda, vuelve a Diagnóstico o escríbenos por WhatsApp.</p>
        <div class="body">
          <form id="form-ag" autocomplete="on">
            <div class="row">
              <div class="field">
                <label for="clientName">Nombre</label>
                <input id="clientName" name="clientName" required placeholder="Tu nombre" />
              </div>
              <div class="field">
                <label for="unitBrand">Unidad — Marca</label>
                <input id="unitBrand" name="unitBrand" placeholder="Ej.: Kenworth, Freightliner, Nissan" />
              </div>
              <div class="field">
                <label for="unitModel">Unidad — Modelo</label>
                <input id="unitModel" name="unitModel" placeholder="Ej.: T680, Cascadia, Versa" />
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label for="unitYear">Unidad — Año</label>
                <input id="unitYear" name="unitYear" type="number" min="1980" max="2099" placeholder="2018" />
              </div>
              <div class="field">
                <label for="service">Servicio</label>
                <select id="service" name="service" required>
                  <option value="">Selecciona…</option>
                  <option>Revisión de frenos</option>
                  <option>Cambio de balatas</option>
                  <option>Revisión de clutch</option>
                  <option>Reconstrucción de clutch</option>
                  <option>Diagnóstico de sistema de aire</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label for="date">Fecha</label>
                <input id="date" name="date" type="date" required />
              </div>
              <div class="field">
                <label for="time">Hora</label>
                <input id="time" name="time" type="time" required />
              </div>
            </div>
            <div class="actions">
              <button class="btn alt" type="submit">Confirmar cita</button>
              <button class="btn ghost" type="button" id="btnToDx">Volver a diagnóstico</button>
            </div>
          </form>
          <div id="ag-result" class="result hidden" aria-live="polite"></div>
        </div>
      </article>

      <!-- PREGUNTAS FRECUENTES -->
      <article id="route-faq" class="card reveal hidden" aria-labelledby="tit-fq">
        <h2 id="tit-fq">Centro de ayuda y preguntas frecuentes</h2>
        <p class="intro">Busca con palabras clave como <em>balatas</em>, <em>pedal</em>, <em>presión de aire</em>. Si no encuentras tu duda, contáctanos por WhatsApp.</p>
        <div class="body">
          <div class="row">
            <div class="field"><input id="faqQuery" placeholder="Ej.: ¿cada cuándo cambio balatas?" /></div>
            <div class="actions"><button class="btn" id="faqSearch">Buscar</button></div>
          </div>
          <div id="faqResults" class="result hidden"></div>
        </div>
      </article>

      <!-- SOBRE NOSOTROS -->
      <article id="route-nosotros" class="card reveal hidden" aria-labelledby="tit-nos">
        <h2 id="tit-nos">Sobre LAGGER: experiencia que da confianza</h2>
        <p class="intro">Especialistas en <strong>clutch, frenos y sistemas de aire</strong> para transporte pesado y ligero. Comunicación clara, procesos documentados y <strong>garantía escrita</strong>.</p>
        <div class="body">
          <div class="row">
            <div class="field">
              <label>¿Por qué elegirnos?</label>
              <ul class="muted" style="margin:0; padding-left:18px; line-height:1.8">
                <li><strong>Experiencia</strong> en tractos, camiones y autos.</li>
                <li><strong>Eficiencia</strong> y puntualidad para reducir tiempos fuera de ruta.</li>
                <li><strong>Refacciones confiables</strong> y procesos trazables.</li>
                <li><strong>Mantenimiento preventivo</strong> por kilometraje.</li>
              </ul>
            </div>
            <div class="field">
              <label>Capacidades & maquinaria</label>
              <ul class="muted" style="margin:0; padding-left:18px; line-height:1.8">
                <li>Rectificado de volantes y platos de clutch.</li>
                <li>Rectificado de discos y tambores (tractocamión).</li>
                <li>Pruebas y diagnóstico de sistema de aire.</li>
              </ul>
            </div>
          </div>
          <div class="row">
            <div class="field">
              <label>Contacto</label>
              <p class="muted" style="margin:.2rem 0 0"><strong>Av. Estado de México #164</strong>, Col. Bello Horizonte, C.P. 54948, <strong>Tultitlán, Edomex</strong><br>Tel: <strong>55 7515 4446</strong> · <strong>55 7312 6969</strong><br>Sitio: <strong>cyf-lagger.com.mx</strong> · Correo: <strong>ventas@cyf-lagger.com.mx</strong></p>
            </div>
          </div>
          <div class="gallery" aria-label="Galería">
            <img src="https://drive.google.com/uc?export=view&id=1fSK1jJPSswpJ9NAwMG01liwuSJdb8hjp" alt="Taller LAGGER">
            <img src="https://drive.google.com/uc?export=view&id=1pyibXq4tURIn0VviqVf8QEU81Pnrto-f" alt="Servicio de frenos LAGGER">
            <img src="https://drive.google.com/uc?export=view&id=1TSVP8S8e8wxSzaVx8Ja5ov7Jl2As0ys6" alt="Servicio de clutch LAGGER">
          </div>
        </div>
      </article>
    </section>

    <!-- Columna lateral -->
    <aside>
      <div class="card reveal">
        <h2 style="padding-bottom:0">Resumen</h2>
        <div class="body">
          <div class="muted">Tu sesión</div>
          <ul id="summary" class="muted" style="line-height:1.8; list-style:none; padding-left:0">
            <li><strong>Lead:</strong> <span id="s-lead">—</span></li>
            <li><strong>Servicio sugerido:</strong> <span id="s-service">—</span></li>
            <li><strong>Fecha/Hora:</strong> <span id="s-dt">—</span></li>
          </ul>
          <div class="actions">
            <button class="btn" id="go-agendar">Agendar ahora</button>
            <button class="btn ghost" id="go-dx">Nuevo diagnóstico</button>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <!-- WhatsApp FAB -->
  <a class="wa-fab" id="waFab"
     href="https://wa.me/525575154446?text=Hola%20LAGGER%2C%20vengo%20de%20la%20web.%20Quiero%20informes%20y%20agendar%20cita."
     target="_blank" rel="noopener">
    <svg viewBox="0 0 32 32" aria-hidden="true"><path d="M19.1 17.1c-.3-.1-1.7-.8-1.9-.9-.3-.1-.5-.1-.7.1-.2.3-.8.9-1 .9-.2 0-.5 0-1-.5-.5-.5-1-1.1-1.1-1.3-.1-.2 0-.4.1-.6.1-.1.2-.3.3-.4.1-.1.1-.2.2-.3.1-.1.1-.3.2-.5 0-.2 0-.4 0-.5 0-.1-.1-.5-.2-.7-.2-.2-.5-.2-.7-.2h-.6c-.2 0-.6.1-.9.4-.3.3-1.2 1.2-1.2 2.9s1.2 3.3 1.4 3.5c.2.2 2.4 3.8 5.8 5.2.8.4 1.5.6 2 .8.8.3 1.5.3 2.1.2.6-.1 1.7-.7 2-1.4.2-.7.2-1.3.1-1.4-.1-.1-.3-.2-.7-.4z" fill="currentColor"/></svg>
    <span>WhatsApp</span>
  </a>

  <div id="toast" class="toast" role="status" aria-live="polite" style="display:none"></div>

  <footer class="wrap">
    <small>© LAGGER. Especialistas Clutch y Frenos.</small>
  </footer>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbwY3iZBAVPqxucaPnj3qI2q8vj61fxkiifcDwQj3NAEI1KKwdhQiriSfMRsUBe4S081OQ/exec";
    const $ = s=>document.querySelector(s); const $$ = s=>[...document.querySelectorAll(s)];
    function toast(msg){ const el=$('#toast'); el.textContent=msg; el.style.display='block'; el.classList.add('show'); setTimeout(()=>{el.classList.remove('show'); el.style.display='none';},2200) }

    const qs = new URLSearchParams(location.search);
    const UTM = { utm_source: qs.get('utm_source')||'', utm_campaign: qs.get('utm_campaign')||'' };
    const state = { lead: qs.get('lead')||localStorage.getItem('lead')||'', serviceSuggested:'', appointment:{date:'',time:'',service:''} };
    function updateSummary(){ $('#s-lead').textContent = state.lead||'—'; $('#s-service').textContent = state.serviceSuggested||'—'; $('#s-dt').textContent = (state.appointment.date&&state.appointment.time)?`${state.appointment.date} ${state.appointment.time}`:'—'; }

    /* HERO VARIANTES (5) */
    const heroVariants = {
      home: {
        title: 'Mantén tu unidad trabajando, sin sorpresas',
        text: 'Diagnóstico claro, citas confirmadas y atención experta en <strong>clutch, frenos y aire</strong> para transporte pesado y ligero.',
        kpis: true,
        img: 'https://drive.google.com/uc?export=view&id=1t6xiJtCjua_H-5DRxCKaHHAH006uCJVo',
        buttons: [{id:'ctaDx', label:'Diagnóstico rápido', kind:'solid'}, {id:'ctaAg', label:'Agendar cita', kind:'ghost'}]
      },
      '#/diagnostico': {
        title: 'Diagnóstico inmediato según el síntoma',
        text: 'Indica el síntoma y obtén posibles fallas, causa probable, tiempo estimado y rango de costo.',
        kpis: true,
        img: 'https://drive.google.com/uc?export=view&id=1t6xiJtCjua_H-5DRxCKaHHAH006uCJVo',
        buttons: [{id:'ctaDx', label:'Ir a Diagnóstico', kind:'solid'}, {id:'ctaAg', label:'Agendar cita', kind:'ghost'}]
      },
      '#/agendar': {
        title: 'Agenda tu servicio en minutos',
        text: 'Elige servicio, fecha y hora. Te confirmamos por WhatsApp y correo.',
        kpis: false,
        img: 'https://drive.google.com/uc?export=view&id=1t6xiJtCjua_H-5DRxCKaHHAH006uCJVo',
        buttons: [{id:'ctaAg', label:'Agendar ahora', kind:'solid'}, {id:'ctaDx', label:'Necesito diagnóstico', kind:'ghost'}]
      },
      '#/faq': {
        title: 'Centro de ayuda y preguntas frecuentes',
        text: 'Encuentra respuestas usando palabras clave como <em>balatas</em>, <em>pedal</em> o <em>presión de aire</em>.',
        kpis: false,
        img: 'https://drive.google.com/uc?export=view&id=1t6xiJtCjua_H-5DRxCKaHHAH006uCJVo',
        buttons: [{id:'ctaDx', label:'Ir a Diagnóstico', kind:'solid'}, {id:'ctaAg', label:'Agendar', kind:'ghost'}]
      },
      '#/nosotros': {
        title: 'Sobre LAGGER: experiencia que da confianza',
        text: 'Especialistas en clutch, frenos y aire. Procesos claros y garantía escrita.',
        kpis: false,
        img: 'https://drive.google.com/uc?export=view&id=1t6xiJtCjua_H-5DRxCKaHHAH006uCJVo',
        buttons: [{id:'ctaAg', label:'Agendar cita', kind:'solid'}]
      }
    };

    function renderHero(hash='home'){
      const v = heroVariants[hash] || heroVariants.home;
      const hero = document.getElementById('heroInner');
      hero.innerHTML = `
        <div>
          <h2>${v.title}</h2>
          <p>${v.text}</p>
          <div class="cta">
            ${v.buttons.map(b => `<button class="btn ${b.kind==='ghost'?'ghost':''}" id="${b.id}">${b.label}</button>`).join('')}
          </div>
          ${v.kpis ? `
          <div class="ribbon">
            <div class="chip">&lt; 5 min<small>Tiempo de respuesta</small></div>
            <div class="chip">+20%<small>Citas confirmadas</small></div>
            <div class="chip">Garantía<small>Servicio profesional</small></div>
          </div>` : ``}
        </div>
        <div class="hero-ill"><img src="${v.img}" alt="LAGGER — clutch, frenos y aire"></div>
      `;
      // Re-wire hero buttons
      $('#ctaDx')?.addEventListener('click',()=>setRoute('#/diagnostico'));
      $('#ctaAg')?.addEventListener('click',()=>setRoute('#/agendar'));
    }

    // SPA routing
    const routes=['#/diagnostico','#/agendar','#/faq','#/nosotros'];
    function setRoute(hash){ if(!routes.includes(hash)) hash = '#/diagnostico';
      $$('#route-diagnostico, #route-agendar, #route-faq, #route-nosotros').forEach(el=>el.classList.add('hidden'));
      $$('.tab').forEach(t=>t.setAttribute('aria-current','false'));
      if(hash==='#/diagnostico'){ $('#route-diagnostico').classList.remove('hidden'); $$('.tab')[0].setAttribute('aria-current','page'); }
      if(hash==='#/agendar'){ $('#route-agendar').classList.remove('hidden'); $$('.tab')[1].setAttribute('aria-current','page'); }
      if(hash==='#/faq'){ $('#route-faq').classList.remove('hidden'); $$('.tab')[2].setAttribute('aria-current','page'); }
      if(hash==='#/nosotros'){ $('#route-nosotros').classList.remove('hidden'); $$('.tab')[3].setAttribute('aria-current','page'); }
      renderHero(hash);
      location.hash = hash;
    }
    $$('.tab').forEach(btn=>btn.addEventListener('click',()=>setRoute(btn.dataset.route)));
    window.addEventListener('hashchange',()=>setRoute(location.hash));

    // CTA hero (inicial)
    $('#ctaDx')?.addEventListener('click',()=>setRoute('#/diagnostico'));
    $('#ctaAg')?.addEventListener('click',()=>setRoute('#/agendar'));

    // Prefill servicio por query
    if(qs.get('service')){ $('#service').value = qs.get('service'); state.serviceSuggested = qs.get('service'); }

    // Form Diagnóstico (sin pedir datos del cliente)
    $('#form-dx').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const payload={
        symptom:$('#symptom').value,
        unitType:$('#unitType').value,
        year:$('#year').value,
        details:($('#details').value||'').slice(0,600),
        lead: state.lead,
        ...UTM
      };
      if(!payload.symptom||!payload.unitType||!payload.year){ toast('Selecciona síntoma, tipo de unidad y año.'); return; }
      const btn = $('#form-dx button[type="submit"]'); btn.disabled=true; btn.textContent='Procesando…';
      try{
        const res = await fetch(API + "?route=diagnose",{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
        const j=await res.json();
        state.serviceSuggested = j.servicio_sugerido || 'Revisión general';
        const $r=$('#dx-result');
        $r.innerHTML = `<div class="row" style="justify-content:space-between; align-items:center">
          <div>
            <div class="status ${j.confianza>=0.66?'ok':(j.confianza>=0.33?'warn':'err')}">Confianza: ${(j.confianza*100||70).toFixed(0)}%</div>
            <h3 style="margin:8px 0 6px">${j.servicio_sugerido || 'Servicio sugerido'}</h3>
            <p class="muted">Causa probable: <strong>${j.probable_causa || 'Por confirmar en taller'}</strong></p>
            <p class="muted">Tiempo estimado: ${j.tiempo_est_min||1}–${j.tiempo_est_max||2} h · Costo estimado: $${j.costo_est_min||1500}–$${j.costo_est_max||3500} MXN</p>
          </div>
          <div class="actions"><button class="btn alt" id="agendarFromDx">Agendar</button></div>
        </div>`;
        $r.classList.remove('hidden');
        // Precargar servicio en Agendar
        $('#service').value = state.serviceSuggested; updateSummary();
        $('#agendarFromDx')?.addEventListener('click',()=>setRoute('#/agendar'));
        toast('Diagnóstico generado.');
      }catch(err){ console.error(err); toast('No se pudo generar el diagnóstico.'); }
      finally{ btn.disabled=false; btn.textContent='Generar diagnóstico'; }
    });

    // Form Agendar (con datos adicionales)
    $('#form-ag').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const payload={
        lead_id:state.lead,
        name: $('#clientName').value,
        unitBrand: $('#unitBrand').value,
        unitModel: $('#unitModel').value,
        unitYear: $('#unitYear').value,
        service: $('#service').value,
        date: $('#date').value,
        time: $('#time').value,
        ...UTM
      };
      if(!payload.name || !payload.service || !payload.date || !payload.time){
        toast('Completa nombre, servicio, fecha y hora.'); return;
      }
      const btn=$('#form-ag button[type="submit"]'); btn.disabled=true; btn.textContent='Confirmando…';
      try{
        const res=await fetch(API + "?route=createBooking",{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
        const j=await res.json();
        const $r=$('#ag-result'); state.appointment={date:payload.date, time:payload.time, service:payload.service};
        $r.innerHTML=`<div class="status ok">Cita confirmada</div>
          <p class="muted">Evento: <strong>${j.eventId || '(pendiente)'}</strong></p>
          <p class="muted">${payload.date} ${payload.time} · Ubicación: Av. Estado de México #164, Bello Horizonte, Tultitlán, Edomex</p>
          <div class="actions"><button class="btn ghost" id="copyTicket">Copiar resumen</button></div>`;
        $r.classList.remove('hidden'); updateSummary();
        $('#copyTicket')?.addEventListener('click',()=>{ 
          const txt=`Cita LAGGER — ${payload.service} | ${payload.date} ${payload.time} | ${payload.name} | ${payload.unitBrand||''} ${payload.unitModel||''} ${payload.unitYear||''} | Av. Estado de México #164, Bello Horizonte, Tultitlán, Edomex`;
          navigator.clipboard.writeText(txt); toast('Copiado ✅'); 
        });
        toast('Cita creada con éxito.');
      }catch(err){ console.error(err); toast('No se pudo crear la cita.'); }
      finally{ btn.disabled=false; btn.textContent='Confirmar cita'; }
    });

    // Accesos rápidos
    $('#go-agendar')?.addEventListener('click',()=>setRoute('#/agendar'));
    $('#go-dx')?.addEventListener('click',()=>setRoute('#/diagnostico'));
    $('#btnToDx')?.addEventListener('click',()=>setRoute('#/diagnostico'));

    // FAQ (mock)
    $('#faqSearch').addEventListener('click', async ()=>{ 
      const q=($('#faqQuery').value||'').trim(); 
      const box=$('#faqResults'); 
      if(!q){ box.classList.add('hidden'); toast('Escribe tu duda.'); return; }
      try{
        const answers=[
          {q:'¿Cada cuándo cambio balatas?', a:'En transporte pesado suele recomendarse cada 20,000–40,000 km según uso y carga. Validar con inspección visual.'},
          {q:'¿Qué hago si el pedal está esponjoso?', a:'Puede ser aire en el sistema o fuga de líquido. Evita circular y agenda revisión.'}
        ];
        box.innerHTML=`<ul>${answers.map(x=>`<li style="margin:8px 0"><strong>${x.q}:</strong> <span class="muted">${x.a}</span></li>`).join('')}</ul>`;
        box.classList.remove('hidden');
      }catch(err){ console.error(err); toast('No se pudo buscar en FAQ.'); }
    });

    // Scroll reveal
    const io = new IntersectionObserver((es)=> es.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target); } }), {threshold:.12});
    $$('.reveal').forEach(el=>io.observe(el));

    // Init
    window.addEventListener('DOMContentLoaded',()=>{
      renderHero('home'); // HERO inicial (home)
      setRoute(location.hash||'#/diagnostico'); 
      updateSummary();
    });
  </script>
</body>
</html>